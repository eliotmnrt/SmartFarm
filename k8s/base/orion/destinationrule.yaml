apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: orion
  namespace: fiware-platform
spec:
  host: orion                          # S'applique au service orion
  
  trafficPolicy:                       # Politiques de trafic
    
    # üîå Connection Pool
    connectionPool:
      tcp:
        maxConnections: 100            # Max 100 connexions TCP simultan√©es
      http:
        http1MaxPendingRequests: 50    # Max 50 requ√™tes en attente (HTTP/1.1)
        http2MaxRequests: 100          # Max 100 streams simultan√©s (HTTP/2)
        maxRequestsPerConnection: 2    # Max 2 requ√™tes par connexion
        # √âvite le "connection reuse" excessif
    
    # ‚öñÔ∏è Load Balancer
    loadBalancer:
      simple: ROUND_ROBIN              # Algorithme : tour √† tour
      # Autres : LEAST_CONN, RANDOM, PASSTHROUGH
    
    # üö® Outlier Detection (Circuit Breaker)
    outlierDetection:
      consecutive5xxErrors: 5             # Apr√®s 5 erreurs cons√©cutives
      interval: 30s                    # P√©riode d'observation : 30s
      baseEjectionTime: 30s            # √âjecter le pod pendant 30s
      maxEjectionPercent: 50           # Max 50% des pods √©ject√©s, ne jamais √©jecter TOUS les pods